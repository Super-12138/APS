import{_ as M,r as f,aJ as z,bm as F,q as j,s as q,v as J,aK as Q,c as i,e as s,d as a,h as r,f as K,F as c,a4 as C,o as n,i as y,j as _,k as h,t as b,p as W,l as G,E as H}from"./index-ba92c6b8.js";import{E as L,a as O}from"./el-table-column-fef6b0da.js";import"./el-checkbox-55ac5a6b.js";import"./el-scrollbar-7101c886.js";import{C as X}from"./CommonPlan-b2bd4878.js";import{P as Y}from"./Pagination-db504da4.js";import"./isEqual-3fc68a3b.js";const g=k=>(W("data-v-e8427389"),k=k(),G(),k),Z={class:"container"},w=g(()=>a("span",{class:"first"},"新增",-1)),ee=[w],te=g(()=>a("span",null,"修改",-1)),le=[te],ae=g(()=>a("span",null,"删除",-1)),oe=[ae],ne=g(()=>a("span",null,"刷新",-1)),se=[ne],ue=g(()=>a("button",null,[a("span",null,"导入")],-1)),de=g(()=>a("button",null,[a("span",null,"导出")],-1)),ie={class:"main"},re={class:"bottom"},ce={__name:"immediateInventory",setup(k){let x=f(1),V=f(20);z();const u=F();j(),q();function D(t){V.value=t,u.getAllPage(x.value,V.value,1).then(o=>{console.log("获取分页表格数据成功")}).catch(o=>{})}f([]),f([]);let I=!0;const R={result:{id:"",avbQty:null,materialId:"",baseQty:null,lot:"",expiryDate:"",stockName:"",materialName:""},chVersion:"",editable:!0},N=f([]);J(()=>{v()});function E(t){t.editable=!0}function S(){N.value.forEach(t=>{t.editable=!0})}const U=f(null);function B(){if(I)u.immediateInventory.data.unshift({...R}),I=!1;else return}function m(t){t.result.id?(u.update({id:t.result.id,version:t.result.version,avbQty:t.result.avbQty,materialId:t.result.materialId,baseQty:t.result.baseQty,lot:t.result.lot,expiryDate:t.result.expiryDate,stockName:t.result.stockName,materialName:t.result.materialName},1).then(o=>{console.log("产能修改成功")}).catch(o=>{v(),console.log(t.id),console.log("产能修改失败")}),t.editable=!1):(u.add({avbQty:t.result.avbQty,materialId:t.result.materialId,baseQty:t.result.baseQty,lot:t.result.lot,expiryDate:t.result.expiryDate,stockName:t.result.stockName,materialName:t.result.materialName},1).then(o=>{I=!0,o.code==200?console.log("产能添加成功"):C.alert("数据不能为空","添加数据失败",{confirmButtonText:"好"}),v()}).catch(o=>{console.log(o),console.log("产能添加失败"),v()}),t.editable=!1)}function P(t){x.value=t,u.getAllPage(t,V.value,1).then(o=>{console.log("获取分页表格数据成功")}).catch(o=>{})}function T(){const t=[];N.value.forEach(o=>{t.push(o.result.id)}),C.confirm("确定删除这些工序吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{u.deleteData(t,1).then(o=>{console.log("删除产能成功"),Q({type:"success",message:"删除成功"}),v()}).catch(o=>{console.log(o),console.log("批量删除产能失败")})}).catch(()=>{Q({type:"info",message:"取消删除"})})}function $(t){N.value=t}function v(){I=!0,u.getAllPage(x.value,V.value,1).then(t=>{Q({type:"success",message:"刷新成功"}),U.value.clearSelection()}).catch(t=>{}),console.log("查询所有工序产能")}return(t,o)=>{const d=O,p=H,A=L;return n(),i(c,null,[s(X,{class:"plan"}),a("div",Z,[a("div",{class:"head"},[a("button",{onClick:B},ee),a("button",{onClick:S},le),a("button",{onClick:T},oe),a("button",{onClick:v},se),ue,de]),a("div",ie,[s(A,{data:K(u).immediateInventory.data,border:"","cell-style":{borderColor:"#9db9d6",textAlign:"center"},"header-cell-style":{borderColor:"#9db9d6",background:"#d9e9f8",color:"#000",textAlign:"center",fontWeight:"500"},"row-key":"id",onSelectionChange:$,onRowDblclick:E,height:"62vh",ref_key:"myTable",ref:U},{default:r(()=>[s(d,{type:"selection","reserve-selection":!0,label:"",width:"35",class:"one"}),s(d,{prop:"result.materialId",label:"物料编码",width:"120"},{default:r(({row:e})=>[e.editable?(n(),y(p,{key:0,modelValue:e.result.materialId,"onUpdate:modelValue":l=>e.result.materialId=l,onKeyup:_(l=>m(e),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])):(n(),i(c,{key:1},[h(b(e.result.materialId),1)],64))]),_:1}),s(d,{prop:"result.materialName",label:"物料名称",width:"280"},{default:r(({row:e})=>[e.editable?(n(),y(p,{key:0,modelValue:e.result.materialName,"onUpdate:modelValue":l=>e.result.materialName=l,onKeyup:_(l=>m(e),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])):(n(),i(c,{key:1},[h(b(e.result.materialName),1)],64))]),_:1}),s(d,{prop:"result.stockName",label:"仓库名称",width:"130"},{default:r(({row:e})=>[e.editable?(n(),y(p,{key:0,modelValue:e.result.stockName,"onUpdate:modelValue":l=>e.result.stockName=l,onKeyup:_(l=>m(e),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])):(n(),i(c,{key:1},[h(b(e.result.stockName),1)],64))]),_:1}),s(d,{prop:"result.baseQty",label:"库存量（基本单位）"},{default:r(({row:e})=>[e.editable?(n(),y(p,{key:0,modelValue:e.result.baseQty,"onUpdate:modelValue":l=>e.result.baseQty=l,onKeyup:_(l=>m(e),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])):(n(),i(c,{key:1},[h(b(e.result.baseQty),1)],64))]),_:1}),s(d,{prop:"result.avbQty",label:"可用量(主单位)",width:"120"},{default:r(({row:e})=>[e.editable?(n(),y(p,{key:0,modelValue:e.result.avbQty,"onUpdate:modelValue":l=>e.result.avbQty=l,onKeyup:_(l=>m(e),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])):(n(),i(c,{key:1},[h(b(e.result.avbQty),1)],64))]),_:1}),s(d,{prop:"result.lot",label:"批号",width:"120"},{default:r(({row:e})=>[e.editable?(n(),y(p,{key:0,modelValue:e.result.lot,"onUpdate:modelValue":l=>e.result.lot=l,onKeyup:_(l=>m(e),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])):(n(),i(c,{key:1},[h(b(e.result.lot),1)],64))]),_:1}),s(d,{prop:"result.expiryDate",label:"有效期至",width:"180"},{default:r(({row:e})=>[e.editable?(n(),y(p,{key:0,modelValue:e.result.expiryDate,"onUpdate:modelValue":l=>e.result.expiryDate=l,onKeyup:_(l=>m(e),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])):(n(),i(c,{key:1},[h(b(e.result.expiryDate),1)],64))]),_:1}),s(d,{prop:"chVersion",label:"版本号",width:"120"})]),_:1},8,["data"])]),a("div",re,[s(Y,{total:K(u).immediateInventory.pages,onChangePage:P,onUpdateSize:D,totalRows:K(u).immediateInventory.total},null,8,["total","totalRows"])])])],64)}}},fe=M(ce,[["__scopeId","data-v-e8427389"]]);export{fe as default};
