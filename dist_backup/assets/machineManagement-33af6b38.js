import{P as L}from"./Pagination-db504da4.js";import{_ as Q,r as v,aJ as X,bg as Y,q as Z,b as w,v as ee,aK as N,c as u,e as c,d as o,h as d,f as F,F as p,a4 as E,o as t,i as r,j as _,k as m,t as f,p as ae,l as le,E as ne}from"./index-ba92c6b8.js";import{E as te,a as oe}from"./el-table-column-fef6b0da.js";import"./el-checkbox-55ac5a6b.js";import"./el-scrollbar-7101c886.js";import{E as se}from"./el-autocomplete-f373dd58.js";import{C as ce}from"./CommonPlan-b2bd4878.js";import"./isEqual-3fc68a3b.js";const g=y=>(ae("data-v-1366de1c"),y=y(),le(),y),ie={class:"container"},ue=g(()=>o("span",{class:"first"},"新增",-1)),de=[ue],pe=g(()=>o("span",null,"修改",-1)),re=[pe],me=g(()=>o("span",null,"删除",-1)),fe=[me],he=g(()=>o("span",null,"刷新",-1)),be=[he],_e=g(()=>o("button",null,[o("span",null,"导入")],-1)),ve=g(()=>o("button",null,[o("span",null,"导出")],-1)),ge={class:"main"},ye={class:"bottom"},Me={__name:"machineManagement",setup(y){let T=v(1),M=v(20);const k=X(),i=Y();Z();function A(e){M.value=e,i.getApsMachineTable(T.value,M.value).then(l=>{console.log("获取機器管理数据成功")}).catch(l=>{})}const P=v([]),V=v([]),R=(e,l)=>{const s=e?P.value.filter(K(e)):P.value;l(s)},W=(e,l)=>{const s=e?V.value.filter(K(e)):V.value;l(s)},K=e=>l=>l.value.indexOf(e)!==-1,x=(e,l)=>{console.log(e,"item"),console.log(l,"row"),l.fProcessId=e.id};w(()=>{k.getProcessNamePools().then(e=>{P.value=k.processNames.data.map(l=>({id:l.id,value:l.processName})),console.log("点开了工序名称的下拉框")}).catch(e=>{}),k.getAllProductFamily().then(e=>{V.value=k.productFamily.map(l=>({value:l})),console.log(V,"点开了产品族的下拉框")}).catch(e=>{})}),console.log(P.value,"processName");let C=!0;const B={fMachineId:"",fMachineName:"",fProductFamily:"",fProcess:"",fProcessId:"",fMachineConfiguration:"",fWorkshop:"",available:"",unavailableDates:"",unavailableTime:"",editable:!0},U=v([]);ee(()=>{I()});function $(e){e.editable=!0}function z(){U.value.forEach(e=>{e.editable=!0})}const S=v(null);function O(){if(C)i.machine.data.unshift({...B}),C=!1;else return}function h(e){console.log("修改数据",e),e.id?(i.addOrUpdateApsMachineTable({id:e.id,fMachineId:e.fMachineId,fMachineName:e.fMachineName,fProductFamily:e.fProductFamily,fProcessId:e.fProcessId,fProcess:e.fProcess,fMachineConfiguration:e.fMachineConfiguration,fWorkshop:e.fWorkshop,available:e.available,unavailableDates:e.unavailableDates,unavailableTime:e.unavailableTime}).then(l=>{console.log("产能修改成功")}).catch(l=>{console.log(e.id),console.log("产能修改失败")}),e.editable=!1):(i.addOrUpdateApsMachineTable({fMachineId:e.fMachineId,fMachineName:e.fMachineName,fProductFamily:e.fProductFamily,fProcess:e.fProcess,fProcessId:e.fProcessId,fMachineConfiguration:e.fMachineConfiguration,fWorkshop:e.fWorkshop,available:e.available,unavailableDates:e.unavailableDates,unavailableTime:e.unavailableTime}).then(l=>{C=!0,l.code==200?console.log("产能添加成功"):E.alert("数据不能为空","添加数据失败",{confirmButtonText:"好"}),I()}).catch(l=>{console.log(l),console.log("产能添加失败")}),e.editable=!1)}function j(e){T.value=e,i.getApsMachineTable(e,M.value).then(l=>{console.log("获取分页表格数据成功")}).catch(l=>{})}function q(){const e=[];U.value.forEach(l=>{e.push(l.id)}),E.confirm("确定删除这些工序吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{i.deleteApsMachineTable(e).then(l=>{console.log("删除产能成功"),N({type:"success",message:"删除成功"}),I()}).catch(l=>{console.log(l),console.log("批量删除产能失败")})}).catch(()=>{N({type:"info",message:"取消删除"})})}function J(e){U.value=e}function I(){C=!0,i.getApsMachineTable(T.value,M.value).then(e=>{N({type:"success",message:"刷新成功"}),S.value.clearSelection()}).catch(e=>{}),console.log("查询所有机器管理")}return(e,l)=>{const s=oe,b=ne,D=se,G=te,H=L;return t(),u(p,null,[c(ce,{class:"plan"}),o("div",ie,[o("div",{class:"head"},[o("button",{onClick:O},de),o("button",{onClick:z},re),o("button",{onClick:q},fe),o("button",{onClick:I},be),_e,ve]),o("div",ge,[c(G,{data:F(i).machine.data,border:"","cell-style":{borderColor:"#9db9d6",textAlign:"center"},"header-cell-style":{borderColor:"#9db9d6",background:"#d9e9f8",color:"#000",textAlign:"center",fontWeight:"500"},"row-key":"id",onSelectionChange:J,onRowDblclick:$,height:"62vh",ref_key:"myTable",ref:S},{default:d(()=>[c(s,{type:"selection","reserve-selection":!0,label:"",width:"35",class:"one"}),c(s,{prop:"fMachineId",label:"机器ID",width:"70"},{default:d(({row:a})=>[a.editable?(t(),r(b,{key:0,modelValue:a.fMachineId,"onUpdate:modelValue":n=>a.fMachineId=n,onKeyup:_(n=>h(a),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])):(t(),u(p,{key:1},[m(f(a.fMachineId),1)],64))]),_:1}),c(s,{prop:"fMachineName",label:"机器名称",width:"200"},{default:d(({row:a})=>[a.editable?(t(),r(b,{key:0,modelValue:a.fMachineName,"onUpdate:modelValue":n=>a.fMachineName=n,onKeyup:_(n=>h(a),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])):(t(),u(p,{key:1},[m(f(a.fMachineName),1)],64))]),_:1}),c(s,{prop:"fProductFamily",label:"产品族",width:"120"},{default:d(({row:a})=>[a.editable?(t(),r(D,{key:0,modelValue:a.fProductFamily,"onUpdate:modelValue":n=>a.fProductFamily=n,"fetch-suggestions":W,clearable:"",class:"inline-input w-50",placeholder:"Please Input",onSelect:x},null,8,["modelValue","onUpdate:modelValue"])):(t(),u(p,{key:1},[m(f(a.fProductFamily),1)],64))]),_:1}),c(s,{prop:"fProcess",label:"工序",width:"150"},{default:d(({row:a})=>[a.editable?(t(),r(D,{key:0,modelValue:a.fProcess,"onUpdate:modelValue":n=>a.fProcess=n,"fetch-suggestions":R,clearable:"",class:"inline-input w-50",placeholder:"Please Input",onSelect:n=>x(n,a)},null,8,["modelValue","onUpdate:modelValue","onSelect"])):(t(),u(p,{key:1},[m(f(a.fProcess),1)],64))]),_:1}),c(s,{prop:"fMachineConfiguration",label:"机器规格"},{default:d(({row:a})=>[a.editable?(t(),r(b,{key:0,modelValue:a.fMachineConfiguration,"onUpdate:modelValue":n=>a.fMachineConfiguration=n,onKeyup:_(n=>h(a),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])):(t(),u(p,{key:1},[m(f(a.fMachineConfiguration),1)],64))]),_:1}),c(s,{prop:"fWorkshop",label:"使用车间",width:"120"},{default:d(({row:a})=>[a.editable?(t(),r(b,{key:0,modelValue:a.fWorkshop,"onUpdate:modelValue":n=>a.fWorkshop=n,onKeyup:_(n=>h(a),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])):(t(),u(p,{key:1},[m(f(a.fWorkshop),1)],64))]),_:1}),c(s,{prop:"available",label:"是否可用",width:"60"},{default:d(({row:a})=>[a.editable?(t(),r(b,{key:0,modelValue:a.available,"onUpdate:modelValue":n=>a.available=n,onKeyup:_(n=>h(a),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])):(t(),u(p,{key:1},[m(f(a.available),1)],64))]),_:1}),c(s,{prop:"unavailableDates",label:"不可用日期",width:"120"},{default:d(({row:a})=>[a.editable?(t(),r(b,{key:0,modelValue:a.unavailableDates,"onUpdate:modelValue":n=>a.unavailableDates=n,onKeyup:_(n=>h(a),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])):(t(),u(p,{key:1},[m(f(a.unavailableDates),1)],64))]),_:1}),c(s,{prop:"unavailableTime",label:"不可以时间",width:"110"},{default:d(({row:a})=>[a.editable?(t(),r(b,{key:0,modelValue:a.unavailableTime,"onUpdate:modelValue":n=>a.unavailableTime=n,onKeyup:_(n=>h(a),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])):(t(),u(p,{key:1},[m(f(a.unavailableTime),1)],64))]),_:1})]),_:1},8,["data"])]),o("div",ye,[c(H,{total:F(i).machine.pages,onChangePage:j,onUpdateSize:A,totalRows:F(i).machine.total},null,8,["total","totalRows"])])])],64)}}},Fe=Q(Me,[["__scopeId","data-v-1366de1c"]]);export{Fe as default};
