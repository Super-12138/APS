import{x as ge,y as q,bh as he,b8 as be,aN as N,S as V,bi as O,aQ as J,W as me,z as X,bj as ye,ah as Ee,aR as $e,A as Se,r as p,$ as y,ap as we,b as Ae,o as w,i as ke,h as f,d as G,B as A,f as t,n as Q,e as k,c as D,a6 as Ne,bk as Ce,F as Ie,a2 as Te,C as E,k as Be,t as Fe,E as _e,at as Ve,j as $,ar as x,be as De,au as Pe,G as Oe,ae as P,bl as Ke,H as Me}from"./index-ba92c6b8.js";import{d as Re,E as We}from"./el-scrollbar-7101c886.js";const Le=()=>Math.floor(Math.random()*1e4),He=ge({valueKey:{type:String,default:"value"},modelValue:{type:[String,Number],default:""},debounce:{type:Number,default:300},placement:{type:q(String),values:["top","top-start","top-end","bottom","bottom-start","bottom-end"],default:"bottom-start"},fetchSuggestions:{type:q([Function,Array]),default:he},popperClass:{type:String,default:""},triggerOnFocus:{type:Boolean,default:!0},selectWhenUnmatched:{type:Boolean,default:!1},hideLoading:{type:Boolean,default:!1},label:{type:String},teleported:be.teleported,highlightFirstItem:{type:Boolean,default:!1},fitInputWidth:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},name:String}),Ue={[N]:l=>V(l),[O]:l=>V(l),[J]:l=>V(l),focus:l=>l instanceof FocusEvent,blur:l=>l instanceof FocusEvent,clear:()=>!0,select:l=>me(l)},ze=["aria-expanded","aria-owns"],je={key:0},qe=["id","aria-selected","onClick"],Y="ElAutocomplete",Ge=X({name:Y,inheritAttrs:!1}),Qe=X({...Ge,props:He,emits:Ue,setup(l,{expose:Z,emit:u}){const o=l,ee=ye(),te=Ee(),K=$e(),i=Se("autocomplete"),n=p(),M=p(),C=p(),R=p();let W=!1,I=!1;const c=p([]),s=p(-1),L=p(""),d=p(!1),S=p(!1),g=p(!1),b=y(()=>i.b(String(Le()))),ae=y(()=>te.style),v=y(()=>(c.value.length>0||g.value)&&d.value),H=y(()=>!o.hideLoading&&g.value),se=y(()=>n.value?Array.from(n.value.$el.querySelectorAll("input")):[]),le=()=>{v.value&&(L.value=`${n.value.$el.offsetWidth}px`)},oe=()=>{s.value=-1},U=Re(async e=>{if(S.value)return;const a=r=>{g.value=!1,!S.value&&(P(r)?(c.value=r,s.value=o.highlightFirstItem?0:-1):Ke(Y,"autocomplete suggestions must be an array"))};if(g.value=!0,P(o.fetchSuggestions))a(o.fetchSuggestions);else{const r=await o.fetchSuggestions(e,a);P(r)&&a(r)}},o.debounce),ne=e=>{const a=!!e;if(u(O,e),u(N,e),S.value=!1,d.value||(d.value=a),!o.triggerOnFocus&&!e){S.value=!0,c.value=[];return}U(e)},re=e=>{var a;K.value||(((a=e.target)==null?void 0:a.tagName)!=="INPUT"||se.value.includes(document.activeElement))&&(d.value=!0)},ue=e=>{u(J,e)},ie=e=>{I?I=!1:(d.value=!0,u("focus",e),o.triggerOnFocus&&!W&&U(String(o.modelValue)))},ce=e=>{setTimeout(()=>{var a;if((a=C.value)!=null&&a.isFocusInsideContent()){I=!0;return}d.value&&m(),u("blur",e)})},pe=()=>{d.value=!1,u(N,""),u("clear")},z=async()=>{v.value&&s.value>=0&&s.value<c.value.length?T(c.value[s.value]):o.selectWhenUnmatched&&(u("select",{value:o.modelValue}),c.value=[],s.value=-1)},de=e=>{v.value&&(e.preventDefault(),e.stopPropagation(),m())},m=()=>{d.value=!1},fe=()=>{var e;(e=n.value)==null||e.focus()},ve=()=>{var e;(e=n.value)==null||e.blur()},T=async e=>{u(O,e[o.valueKey]),u(N,e[o.valueKey]),u("select",e),c.value=[],s.value=-1},B=e=>{if(!v.value||g.value)return;if(e<0){s.value=-1;return}e>=c.value.length&&(e=c.value.length-1);const a=M.value.querySelector(`.${i.be("suggestion","wrap")}`),h=a.querySelectorAll(`.${i.be("suggestion","list")} li`)[e],F=a.scrollTop,{offsetTop:j,scrollHeight:_}=h;j+_>F+a.clientHeight&&(a.scrollTop+=_),j<F&&(a.scrollTop-=_),s.value=e,n.value.ref.setAttribute("aria-activedescendant",`${b.value}-item-${s.value}`)};return we(R,()=>{v.value&&m()}),Ae(()=>{n.value.ref.setAttribute("role","textbox"),n.value.ref.setAttribute("aria-autocomplete","list"),n.value.ref.setAttribute("aria-controls","id"),n.value.ref.setAttribute("aria-activedescendant",`${b.value}-item-${s.value}`),W=n.value.ref.hasAttribute("readonly")}),Z({highlightedIndex:s,activated:d,loading:g,inputRef:n,popperRef:C,suggestions:c,handleSelect:T,handleKeyEnter:z,focus:fe,blur:ve,close:m,highlight:B}),(e,a)=>(w(),ke(t(Pe),{ref_key:"popperRef",ref:C,visible:t(v),placement:e.placement,"fallback-placements":["bottom-start","top-start"],"popper-class":[t(i).e("popper"),e.popperClass],teleported:e.teleported,"gpu-acceleration":!1,pure:"","manual-mode":"",effect:"light",trigger:"click",transition:`${t(i).namespace.value}-zoom-in-top`,persistent:"",role:"listbox",onBeforeShow:le,onHide:oe},{content:f(()=>[G("div",{ref_key:"regionRef",ref:M,class:A([t(i).b("suggestion"),t(i).is("loading",t(H))]),style:Q({[e.fitInputWidth?"width":"minWidth"]:L.value,outline:"none"}),role:"region"},[k(t(We),{id:t(b),tag:"ul","wrap-class":t(i).be("suggestion","wrap"),"view-class":t(i).be("suggestion","list"),role:"listbox"},{default:f(()=>[t(H)?(w(),D("li",je,[k(t(Ne),{class:A(t(i).is("loading"))},{default:f(()=>[k(t(Ce))]),_:1},8,["class"])])):(w(!0),D(Ie,{key:1},Te(c.value,(r,h)=>(w(),D("li",{id:`${t(b)}-item-${h}`,key:h,class:A({highlighted:s.value===h}),role:"option","aria-selected":s.value===h,onClick:F=>T(r)},[E(e.$slots,"default",{item:r},()=>[Be(Fe(r[e.valueKey]),1)])],10,qe))),128))]),_:3},8,["id","wrap-class","view-class"])],6)]),default:f(()=>[G("div",{ref_key:"listboxRef",ref:R,class:A([t(i).b(),e.$attrs.class]),style:Q(t(ae)),role:"combobox","aria-haspopup":"listbox","aria-expanded":t(v),"aria-owns":t(b)},[k(t(_e),Ve({ref_key:"inputRef",ref:n},t(ee),{clearable:e.clearable,disabled:t(K),name:e.name,"model-value":e.modelValue,onInput:ne,onChange:ue,onFocus:ie,onBlur:ce,onClear:pe,onKeydown:[a[0]||(a[0]=$(x(r=>B(s.value-1),["prevent"]),["up"])),a[1]||(a[1]=$(x(r=>B(s.value+1),["prevent"]),["down"])),$(z,["enter"]),$(m,["tab"]),$(de,["esc"])],onMousedown:re}),De({_:2},[e.$slots.prepend?{name:"prepend",fn:f(()=>[E(e.$slots,"prepend")])}:void 0,e.$slots.append?{name:"append",fn:f(()=>[E(e.$slots,"append")])}:void 0,e.$slots.prefix?{name:"prefix",fn:f(()=>[E(e.$slots,"prefix")])}:void 0,e.$slots.suffix?{name:"suffix",fn:f(()=>[E(e.$slots,"suffix")])}:void 0]),1040,["clearable","disabled","name","model-value","onKeydown"])],14,ze)]),_:3},8,["visible","placement","popper-class","teleported","transition"]))}});var xe=Oe(Qe,[["__file","/home/runner/work/element-plus/element-plus/packages/components/autocomplete/src/autocomplete.vue"]]);const Ze=Me(xe);export{Ze as E};
