import{u as G,r as p,w as H,b as R,c as P,d as D,e as Y,n as Z,f as U,F as K,o as J}from"./index-ba92c6b8.js";import{c as Q,i as X,E as tt}from"./index-af1d454b.js";import"./el-scrollbar-7101c886.js";import"./isEqual-3fc68a3b.js";const et={class:"block"},nt=D("span",{class:"demonstration"},"请选择开始时间和结束时间：",-1),ot={style:{height:"100%","overflow-y":"auto"}},it={__name:"product",setup(at){const w=G(),M=p("");let S=p(0),g=p([]),E=p([]);const u=p([]);let f,x=null,y=null;const I=[{text:"Last week",value:()=>{const t=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*7),[e,t]}},{text:"Last month",value:()=>{const t=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*30),[e,t]}},{text:"Last 3 months",value:()=>{const t=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*90),[e,t]}}];function z(t){if(t.length!==2)throw new Error("Expected an array with 2 date strings");function e(a){let n=new Date(a),r=n.getFullYear(),s=(n.getMonth()+1).toString().padStart(2,"0"),o=n.getDate().toString().padStart(2,"0");return`${r}-${s}-${o}`}g.value=t.map(a=>e(a))}H(g,(t,e)=>{E.value=A(t[0],t[1]),N(E.value)});const c=[{name:"包装",color:"#0053b5"},{name:"测试",color:"#1d89e9"},{name:"组装",color:"#9db9d6"}],d=[];for(let t in w.product){const e=Object.values(w.product[t]),a=Object.keys(w.product[t]);for(let n=0;n<a.length;n++){const r=a[n],s=e[n].map(o=>({name:o.processName,quantity:o.quantity,taskDate:o.taskDate,start:o.startTime,end:o.endTime}));d.push({product:r,processes:s})}}const l=[...new Set(d.flatMap(t=>t.processes.map(e=>e.taskDate)))].sort();S=c.length*d.length*40;function v(t,e){const[a,n]=e.split(":").map(Number),r=l.indexOf(t)*12*60,s=(a-8)*60+n;return r+s}function A(t,e){const a=new Date(t);a.setHours(0,0,0,0);const n=new Date(e);return n.setHours(23,59,59,999),d.map(r=>({...r,processes:r.processes.filter(s=>{const o=new Date(s.taskDate);return o>=a&&o<=n})})).filter(r=>r.processes.length>0)}function q(){d.forEach((t,e)=>{c.forEach((a,n)=>{t.processes.filter(s=>s.name===a.name).forEach(s=>{const o=v(s.taskDate,s.start),i=v(s.taskDate,s.end);o!==null&&i!==null&&u.value.push({name:s.name,value:[o,e*c.length+n,i],itemStyle:{color:a.color},quantity:s.quantity})})})})}const $=6/l.length*100,h={tooltip:{formatter:function(t){return t.marker+t.name+": "+(t.value[2]-t.value[0])+"分钟"}},title:{text:"测试甘特图",left:"center"},dataZoom:[{type:"slider",xAxisIndex:[0],orient:"horizontal",filterMode:"filter",showDataShadow:!1,bottom:20,start:0,end:$,moveOnMouseMove:!1,zoomOnMouseWheel:!1},{type:"inside",xAxisIndex:[0],filterMode:"filter",zoomOnMouseWheel:!1}],grid:{left:"15%",height:S-130},xAxis:{type:"value",min:function(){return x!==null?x*12*60:0},max:l.length*12*60,interval:12*60,axisLabel:{formatter:function(t){const e=Math.floor(t/720);if(e===l.length){const a=new Date(l[l.length-1]),n=new Date(a);n.setDate(a.getDate()+1);const r=n.getFullYear(),s=n.getMonth()+1,o=n.getDate();return`${r}-${s<10?"0"+s:s}-${o<10?"0"+o:o}`}return l[e]}},splitLine:{show:!0}},yAxis:{data:d.flatMap(()=>c.map(t=>t.name)),axisTick:{interval:t=>t%c.length===0},axisLabel:{fontSize:10,interval:t=>t%c.length===0,formatter:(t,e)=>e%c.length===0?d[Math.floor(e/c.length)].product:""}},series:[{type:"custom",renderItem:j,itemStyle:{opacity:.8},encode:{x:[0,2],y:1},data:u.value}]};function N(t){u.value=[],t.forEach((e,a)=>{c.forEach((n,r)=>{e.processes.filter(o=>o.name===n.name).forEach(o=>{const i=v(o.taskDate,o.start),m=v(o.taskDate,o.end);i!==null&&m!==null&&u.value.push({name:o.name,value:[i,a*c.length+r,m],itemStyle:{color:n.color},quantity:o.quantity})})})}),h.series[0].data=[...u.value],y=l.indexOf(g.value[1]),y===-1&&(console.error("选择的结束日期不在可用的日期列表中!"),y=l.length-1),x=l.indexOf(g.value[0]),x===-1&&(console.error("选择的日期不在可用的日期列表中!"),x=null),h.xAxis.max=(y+1)*12*60,f&&f.setOption(h,!0)}const F=[];for(let t=0;t<=24;t+=4)F.push(t.toString().padStart(2,"0")+":00");function L(){const t=document.getElementById("container");f=X(t)}function V(t,e){const n=document.createElement("canvas").getContext("2d");return n.font=`${e}px sans-serif`,n.measureText(t).width}function j(t,e){const a=e.value(1),n=e.coord([e.value(0),a]),r=e.coord([e.value(2),a]),s=e.size([0,1])[1]*.8,o=Q({x:n[0],y:n[1]-s/2,width:r[0]-n[0],height:s},{x:t.coordSys.x,y:t.coordSys.y,width:t.coordSys.width,height:t.coordSys.height}),i=u.value[t.dataIndex].name,m=u.value[t.dataIndex].quantity,b=`${i}-${m}`,_=[(n[0]+r[0])/2,n[1]],T=14,k=V(b,T),C=T,W=k<=o.width&&C<=o.height&&_[0]+k/2<=t.coordSys.x+t.coordSys.width&&_[0]-k/2>=t.coordSys.x,O=[{type:"rect",shape:o,style:e.style()}];return W&&O.push({type:"text",position:_,style:{text:b,textAlign:"center",textVerticalAlign:"middle",fontSize:T,fill:"#ffffff",fontWeight:"400"}}),o?{type:"group",children:O}:null}function B(t,e){let a;return function(...n){const r=this;clearTimeout(a),a=setTimeout(()=>t.apply(r,n),e)}}return R(()=>{L(),q();const t=12*60;let e=!1;f.on("datazoom",B(function(a){if(e)return;const n=l.length*12*60,r=a.start*n/100,s=r%t;let o;s>t/2?o=r+(t-s):o=r-s,e=!0;const i=o*100/n,m=i-a.start;f.setOption({dataZoom:[{start:i,end:a.end+m}]}),e=!1},300)),h&&typeof h=="object"&&f.setOption(h)}),(t,e)=>{const a=tt;return J(),P(K,null,[D("div",et,[nt,Y(a,{onChange:z,modelValue:M.value,"onUpdate:modelValue":e[0]||(e[0]=n=>M.value=n),type:"daterange","unlink-panels":"","range-separator":"To","start-placeholder":"Start date","end-placeholder":"End date",shortcuts:I},null,8,["modelValue"])]),D("div",ot,[D("div",{id:"container",style:Z({height:U(S)+"px"})},null,4)])],64)}}};export{it as default};
