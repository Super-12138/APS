import{u as G,r as y,w as H,b as R,c as j,d as v,e as Z,n as X,f as J,F as K,o as Q}from"./index-ba92c6b8.js";import{c as tt,i as et,E as nt}from"./index-af1d454b.js";import"./el-scrollbar-7101c886.js";import"./isEqual-3fc68a3b.js";const ot={class:"block"},at=v("span",{class:"demonstration"},"请选择开始时间和结束时间：",-1),st={style:{height:"100%","overflow-y":"auto"},class:"gantt-chart-container"},dt={__name:"test",setup(lt){const N=G(),M=y("");let w=y(0),x=y([]),E=y([]);const u=y([]);let f,g=null,p=null;const O=[{text:"Last week",value:()=>{const t=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*7),[e,t]}},{text:"Last month",value:()=>{const t=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*30),[e,t]}},{text:"Last 3 months",value:()=>{const t=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*90),[e,t]}}];function A(t){if(t.length!==2)throw new Error("Expected an array with 2 date strings");function e(o){let n=new Date(o),l=n.getFullYear(),s=(n.getMonth()+1).toString().padStart(2,"0"),a=n.getDate().toString().padStart(2,"0");return`${l}-${s}-${a}`}x.value=t.map(o=>e(o))}H(x,(t,e)=>{E.value=b(t[0],t[1]),F(E.value)});const i=[{name:"包装",color:"#0053b5"},{name:"测试",color:"#1d89e9"},{name:"组装",color:"#9db9d6"}],d=[];N.product.forEach(t=>{const e=t.materialName,o=t.apsAllPlanNumInProcesses.map(n=>({name:n.processName,quantity:n.quantity,taskDate:n.taskDate,start:n.startTime,end:n.endTime}));d.push({product:e,processes:o})});const r=[...new Set(d.flatMap(t=>t.processes.map(e=>e.taskDate)))].sort();w=i.length*d.length*40;function D(t,e){const[o,n]=e.split(":").map(Number),l=r.indexOf(t)*12*60,s=(o-8)*60+n;return l+s}function b(t,e){const o=new Date(t);o.setHours(0,0,0,0);const n=new Date(e);return n.setHours(23,59,59,999),d.map(l=>({...l,processes:l.processes.filter(s=>{const a=new Date(s.taskDate);return a>=o&&a<=n})})).filter(l=>l.processes.length>0)}function z(){d.forEach((t,e)=>{i.forEach((o,n)=>{t.processes.filter(s=>s.name===o.name).forEach(s=>{const a=D(s.taskDate,s.start),c=D(s.taskDate,s.end);a!==null&&c!==null&&u.value.push({name:s.name,value:[a,e*i.length+n,c],itemStyle:{color:o.color},quantity:s.quantity})})})})}const q=2/r.length*100,h={tooltip:{formatter:function(t){return t.marker+t.name+": "+(t.value[2]-t.value[0])+"分钟"}},title:{text:"测试甘特图",left:"center"},dataZoom:[{type:"slider",xAxisIndex:[0],orient:"horizontal",filterMode:"filter",showDataShadow:!1,bottom:20,start:0,end:q,moveOnMouseMove:!1,zoomOnMouseWheel:!1},{type:"inside",xAxisIndex:[0],filterMode:"filter",zoomOnMouseWheel:!1}],grid:{left:"15%",height:w-130},xAxis:{type:"value",min:function(){return g!==null?g*12*60:0},max:r.length*12*60,interval:12*60,axisLabel:{formatter:function(t){const e=Math.floor(t/720);if(e===r.length){const o=new Date(r[r.length-1]),n=new Date(o);n.setDate(o.getDate()+1);const l=n.getFullYear(),s=n.getMonth()+1,a=n.getDate();return`${l}-${s<10?"0"+s:s}-${a<10?"0"+a:a}`}return r[e]}},splitLine:{show:!0}},yAxis:{data:d.flatMap(()=>i.map(t=>t.name)),axisTick:{interval:t=>t%i.length===0},axisLabel:{fontSize:10,interval:t=>t%i.length===0,formatter:(t,e)=>e%i.length===0?d[Math.floor(e/i.length)].product:""}},series:[{type:"custom",renderItem:B,itemStyle:{opacity:.8},encode:{x:[0,2],y:1},data:u.value}]};function $(){h.series[0].data=[...u.value],p=r.indexOf(x.value[1]),console.log(x.value[1],r),p===-1&&(console.error("选择的结束日期不在可用的日期列表中!"),p=r.length-1),g=r.indexOf(x.value[0]),g===-1&&(console.error("选择的日期不在可用的日期列表中!"),g=null),h.xAxis.max=(p+1)*12*60}function F(t){u.value=[],t.forEach((e,o)=>{i.forEach((n,l)=>{e.processes.filter(a=>a.name===n.name).forEach(a=>{const c=D(a.taskDate,a.start),m=D(a.taskDate,a.end);c!==null&&m!==null&&u.value.push({name:a.name,value:[c,o*i.length+l,m],itemStyle:{color:n.color},quantity:a.quantity})})})}),$(),f&&f.setOption(h,!0)}const L=[];for(let t=0;t<=24;t+=4)L.push(t.toString().padStart(2,"0")+":00");function V(){const t=document.getElementById("container");f=et(t)}function Y(t,e){const n=document.createElement("canvas").getContext("2d");return n.font=`${e}px sans-serif`,n.measureText(t).width}function B(t,e){const o=e.value(1),n=e.coord([e.value(0),o]),l=e.coord([e.value(2),o]),s=e.size([0,1])[1]*.8,a=tt({x:n[0],y:n[1]-s/2,width:l[0]-n[0],height:s},{x:t.coordSys.x,y:t.coordSys.y,width:t.coordSys.width,height:t.coordSys.height}),c=u.value[t.dataIndex].name,m=u.value[t.dataIndex].quantity,k=`${c}-${m}`,S=[(n[0]+l[0])/2,n[1]],_=14,T=Y(k,_),U=_,W=T<=a.width&&U<=a.height&&S[0]+T/2<=t.coordSys.x+t.coordSys.width&&S[0]-T/2>=t.coordSys.x,I=[{type:"rect",shape:a,style:e.style()}];return W&&I.push({type:"text",position:S,style:{text:k,textAlign:"center",textVerticalAlign:"middle",fontSize:_,fill:"#ffffff",fontWeight:"400"}}),a?{type:"group",children:I}:null}function C(t,e){let o;return function(...n){const l=this;clearTimeout(o),o=setTimeout(()=>t.apply(l,n),e)}}function P(){let e=!1;f.on("datazoom",C(function(o){if(e)return;const n=r.length*12*60,l=o.start*n/100,s=l%720;let a;s>720/2?a=l+(720-s):a=l-s,e=!0;const c=a*100/n,m=c-o.start;f.setOption({dataZoom:[{start:c,end:o.end+m}]}),e=!1},300))}return R(()=>{V(),z(),P(),h&&typeof h=="object"&&f.setOption(h)}),(t,e)=>{const o=nt;return Q(),j(K,null,[v("div",ot,[at,Z(o,{onChange:A,modelValue:M.value,"onUpdate:modelValue":e[0]||(e[0]=n=>M.value=n),type:"daterange","unlink-panels":"","range-separator":"To","start-placeholder":"Start date","end-placeholder":"End date",shortcuts:O},null,8,["modelValue"])]),v("div",st,[v("div",{id:"container",style:X({height:J(w)+"px"})},null,4)])],64)}}};export{dt as default};
